<div class="modal-overlay">
  <div id="modal-add-city" class="flex-column">
    <i class="bi bi-x-lg close"></i>

    <input class="city-name" type="text" placeholder="NOMBRE DE LA CIUDAD" />
    <input class="date" type="date" />
    <hr />

    <p>BLOQUE 1</p>
    <div class="bloque flex-row">
      <label class="flex-row">
        <i class="bi bi-upload"></i>
        <img class="preview-img" src="" alt="" style="display: none;" />
        <input class="img" type="file" accept="image/*" />
        <i class="bi bi-copy"></i>
      </label>
      <label>
        <textarea class="text" placeholder="text1"></textarea>
        <i class="bi bi-copy"></i>
      </label>
    </div>

    <br />

    <div class="buttons flex-row">
      <button class="boton1">guardar</button>
      <button class="boton2 cancel">cancelar</button>
    </div>
  </div>
</div>

<style>
  #modal-add-city {
    background-color: var(--clr-dark);
    padding: 20px;
    border: solid 1px var(--clr-border);
    width: 500px;
    position: relative;
    gap: 5px;
    align-items: flex-start;
    max-height: 80%;
    overflow-y: auto;
  }

  #modal-add-city .close {
    position: absolute;
    top: 20px;
    right: 20px;
    font-size: 20px;
    cursor: pointer;
    border: solid 1px var(--clr-border);
    padding: 7px;
  }

  .buttons {
    gap: 5px;
  }

  label {
    width: 100%;
    color: var(--clr-text);
    border: solid 1px var(--clr-border);
    height: 190px;
    position: relative;
  }

  .bi-copy {
    position: absolute;
    bottom: 5px;
    right: 5px;
    font-size: 1.2rem;
    cursor: pointer;
    z-index: 10;
    padding: 10px;
  }

  label input,
  label textarea {
    border: none;
    width: 100%;
    height: 100%;
    background-color: transparent;
    color: var(--clr-text);
    font-size: 1rem;
    padding: 5px 7px;
  }

  textarea {
    resize: none;
  }

  /* Scrollbar delgada para textarea */
  textarea::-webkit-scrollbar {
    width: 4px;
  }

  textarea::-webkit-scrollbar-track {
    background: transparent;
  }

  textarea::-webkit-scrollbar-thumb {
    background-color: var(--clr-text);
    border-radius: 10px;
  }

  textarea::-webkit-scrollbar-thumb:hover {
    background-color: var(--clr-gray);
  }

  label textarea:focus {
    outline: none;
    background-color: var(--clr-border);
  }

  input[type="file"] {
    display: none;
  }

  label .bi-upload {
    font-size: 3rem;
    cursor: pointer;
  }

  .preview-img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    cursor: pointer;
  }

  .bloque {
    width: 100%;
    gap: 5px;
  }

  @media (hover: hover) {
    .bi-copy:hover {
      background-color: var(--clr-border);
    }
  }
</style>

<script>
  //@ts-nocheck
  const $close_modal = document.querySelector("#modal-add-city .close");
  const $boton_cancelar = document.querySelector("#modal-add-city .cancel");
  const $modal_add_city = document.querySelector(".modal-overlay");
  const $inputFile = document.querySelector(".img");
  const $previewImg = document.querySelector(".preview-img");
  const $uploadIcon = document.querySelector(".bi-upload");

  // Cerrar con botones
  $close_modal.addEventListener("click", closeModal);
  $boton_cancelar.addEventListener("click", closeModal);

  // Cerrar al clickear fuera del modal
  $modal_add_city.addEventListener("click", (e) => {
    if (e.target === $modal_add_city) {
      closeModal();
    }
  });

  // Cerrar con tecla ESC
  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape") {
      closeModal();
    }
  });

  // Preview de imagen
  $inputFile.addEventListener("change", (e) => {
    const file = e.target.files[0];

    if (file) {
      const reader = new FileReader();

      reader.onload = (e) => {
        $previewImg.src = e.target.result;
        $previewImg.style.display = "block";
        $uploadIcon.style.display = "none";
      };

      reader.readAsDataURL(file);
    }
  });

  function closeModal() {
    $modal_add_city.style.display = "none";
  }
</script>
